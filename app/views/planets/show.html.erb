<meta http-equiv="refresh" content ="15">
<script>
document.title = "<%= @planet.name %>"
</script>

<% if @planet.generic_fleets.any? { |unit| unit.squad == @squad } %>
<div class="planet_content">
<h2>
    <info class="tooltip">
    <tip>Mapa BF2: <%= @planet.description %></tip>
        <%= @planet.name %>
      </info> 
      <info class="tooltip">
        <tip>Conexão direta com <%= @planet.routes.last %> </tip>
        <%= ' (wormhole) ' if @planet.wormhole? %>
      </info>
      <info class="tooltip">
        <tip>Estacao de negociacao (zona neutra)<br>Vender: 50% do valor da unidade.<br>Comprar: Descontos de 10% a 50%</tip>
      <%= ' (tradeport)' if @planet.tradeport? %>
      </info>
    </h2>

    <%= "Ganhos previstos (Espaço: $#{@planet.air_credits} / Terra: $#{@planet.ground_credits})  " if @planet.credits_per_turn.present? && @planet.credits_per_turn > 0 && !@planet.under_attack? && !@planet.tradeport? %>
<p>
    <table>
    <% if @round.move %>
      <tr bgcolor=#223333><td align=center>Qtde:</td><td>Destino:</td><td></td><td>Unidade:</td></tr>
      <% form_tag "/generic_fleets/move" do %>
         
        <% @planet.generic_fleets.each do |fleet| %>
          <tr> 
          <%= simple_fields_for "fleets[]", fleet do |fleet_form| %>
            <% if fleet_form.object.carried_by == nil %>
              <% if fleet_form.object.type?(Commander) || fleet_form.object.type?(Warrior) %>
                <td align=right><%= fleet_form.input :quantity, :collection => 1..fleet_form.object.quantity, :label => false %></td>
              <% else %>
                <td><%= fleet_form.association :destination, :collection => @planet.routes, :disabled => false, :label => false %></td>
              <% end %>
            <% end %>
          <% end %>
          <td> </td>
          <% if fleet.squad == @squad %>           
          <td><span style=color:#<%= fleet.squad.color %>>
          <% case fleet.generic_unit.type %>
            <% when 'Facility' %>
              <%= render :partial => 'facilities', :locals => { :fleet => fleet } %>
            <% when 'CapitalShip' %>
              <%= render :partial => 'capital_ships', :locals => { :fleet => fleet } %>
            <% when 'Warrior' %>
              <%= render :partial => 'warriors', :locals => { :fleet => fleet } if fleet.carried_by == nil %>
            <% when 'Commander' %>
              <%= render :partial => 'commanders', :locals => { :fleet => fleet } if fleet.carried_by == nil  %>
            <% when 'Trooper' %>
              <%= render :partial => 'troopers', :locals => { :fleet => fleet } if fleet.carried_by == nil %>
            <% when 'Armament' %>
              <%= render :partial => 'armaments', :locals => { :fleet => fleet } if fleet.carried_by == nil %>
            <% when 'LightTransport' %>
              <%= render :partial => 'light_transports', :locals => { :fleet => fleet } %>
            <% when 'Fighter' %>
              <%= render :partial => 'fighters', :locals => { :fleet => fleet } if fleet.carried_by == nil %>
            <% when 'Sensor' %>
              <%= render :partial => 'sensors', :locals => { :fleet => fleet } %>
            <% else %>
              <%= render :partial => 'fleets', :locals => { :fleet => fleet } if fleet.carried_by == nil %>
          <% end %></span>
          <% else %>
            <td><span style=color:#<%= fleet.squad.color %>>
            <%= fleet.squad.name %>
          <% end %>
  
          <% if fleet.carried_by == nil %>
            <span style=color:#40E0D0><%= fleet.show_results %></span>
            <span style=color:#40E0D0><%= "--> #{fleet.destination.name} " if fleet.moving? && fleet.squad == @squad && @round.move %></span></td>
          <% else %>
            </td>
          <% end %>

        <% end %>
        </table>
        <%= submit_tag 'Mover' %>
        <br>
      <% end %>

   <% end %>

   <% if @round.move %>
     Para cancelar um movimento apague ou coloque 0 (zero) na qtde.
   <% end %>
<p>
   <% if @round.move && @planet.tradeport? && !@squad.ready? %>
<a href = "" onclick="window.open('/tradeports/<%= @planet.id %>', 'Tradeport <%= @planet.name %>', 'toolbar=no, location=no, scrollbars=yes, resizable=no, width=465, height=260')">tradeport</a> 
   <% end %>
      
   <% if @round.attack && @planet.under_attack? && !@squad.ready?  %>
     <a href = "" onclick="window.open('/planets/<%= @planet.id %>/results', 'Resultados <%= @planet.name %>', 'toolbar=no, location=no, scrollbars=yes, resizable=yes, width=630, height=540')">postar resultados</a>
   <% end %>
<p>
    <% if @round.attack && @planet.under_attack? && !@planet.tradeport? %>
      <info class="tooltip">
        <tip>No XWA, o atacante monta a frota primeiro e usa os slots de cima.<br>No BF2, o atacante escolhe o award primeiro.</tip>
         Atacante -> <span style=color:#<%= @planet.first_player.color %>><%= @planet.first_player.name %></span><br>
      </info>
      <% if @planet.squads.count > 2 %>
        <% mid_defense = @all_squads.reject {|x| x == @planet.first_player or x == @planet.last_player}.first %>
        <info class="tooltip">
          <tip>No XWA, o defensor inicial é o host do jogo, usa os slots de baixo e monta a frota por último.<br>No BF2, o defensor inicial é o host do jogo e escolhe o award por último.<br>O defensor inicial joga contra o atacante (em combates 1x1x1).</tip>
          Defensor inicial -> <span style=color:#<%= mid_defense.color %>><%=  mid_defense.name %></span><br>
        </info>
      <% end %>
      <info class="tooltip">
        <tip>No XWA, o defensor é o host do jogo, usa os slots de baixo e monta a frota por último.<br>No BF2, o defensor é o host do jogo e escolhe o award por último.<br>O defensor é o último a jogar (em combates 1x1x1).</tip>
        Defensor-> <span style=color:#<%= @planet.last_player.color %>><%= @planet.last_player.name %></span>
      </info>
    <% end %>
    <% if @round.attack && @planet.under_attack? && @planet.tradeport? %>
      Zona Neutra
    <% end %>
</div>
<% else %>
<div class="fleet">
Não há unidades do seu esquadrão neste planeta.
</div>
<% end %>
